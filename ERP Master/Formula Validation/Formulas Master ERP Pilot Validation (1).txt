Formula ERP Pilot Validation script


---> Formula Header

FORMULAID is blank --- Warning --- 3
FORMULANAME is blank --- Warning --- 3
ISAPPROVED is blank --- Warning --- 3
PRODUCTIONSITEID is blank --- Warning --- 3
LegacyFormulaId is blank --- Warning --- 3
OldBOMCode is blank --- Warning --- 3

FORMULAID,DATAAREAID has duplicate values --- Constraint --- 1

PRODUCTIONSITEID is not there in SITEID of Sites --- Error --- 2




---> Formula Lines

FORMULAID is null --- Error --- 2
ITEMNUMBER is null --- Warning --- 2
PRODUCTUNITSYMBOL is null --- Warning --- 2
CONSUMPTIONWAREHOUSEID is null --- Warning --- 3
FORMULAQUANTITYPERCENTAGE is null --- Warning --- 3
LINETYPE is null --- Warning --- 3
QUANTITY is null --- Warning --- 3
ROUTEOPERATIONNUMBER is null --- Warning --- 3
VARIABLESCRAPPERCENTAGE is null --- Warning --- 3

LINETYPE has invalid enum values --- Error --- 2

FORMULAID,DATAAREAID has duplicate values --- Constraint --- 1

FORMULAID is not there in FORMULAID of Formula Headers --- Error --- 2
ITEMNUMBER is not there in ITEMNUMBER of Released products --- Error --- 2
PRODUCTUNITSYMBOL is not there in UnitSymbol of Units --- Error --- 2
CONSUMPTIONWAREHOUSEID is not there in WAREHOUSEID of Warehouses --- Error --- 2






-----> Formula Versions

FORMULAID is blank --- Error --- 2
MANUFACTUREDITEMNUMBER is blank --- Error --- 2
FORMULABATCHSIZE is blank --- Warning --- 3
ISACTIVE is blank --- Warning --- 3
ISAPPROVED is blank --- Warning --- 3
PRODUCTIONSITEID is blank --- Warning --- 3
VALIDFROMDATE is blank --- Warning --- 3
VALIDTODATE is blank --- Warning --- 3
VERSIONNAME is blank --- Warning --- 3
YIELDPERCENTAGE is blank --- Warning --- 3

FORMULAID,DATAAREAID has duplicate values --- Constraint --- 1

FORMULAID is not there in FORMULAID of Formula Headers --- Error --- 2
MANUFACTUREDITEMNUMBER is not there in ITEMNUMBER of Released products --- Error --- 2
PRODUCTIONSITEID is not there in SITEID of Sites --- Error --- 2










--------------------------------------------------- Validation Scripts -------------------------------------------------


CREATE OR ALTER PROC PROC_DEMO_ARP_VALIDATE_FORMULA AS
BEGIN

----Formula Headers

UPDATE PWC_E_PMFFORMULAHEADERSTAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'FORMULAID is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_PMFFORMULAHEADERSTAGING	
	WHERE 
		FORMULAID= '' or FORMULAID is null

UPDATE PWC_E_PMFFORMULAHEADERSTAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'FORMULANAME is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_PMFFORMULAHEADERSTAGING	
	WHERE 
		FORMULANAME= '' or FORMULANAME is null

UPDATE PWC_E_PMFFORMULAHEADERSTAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'ISAPPROVED is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_PMFFORMULAHEADERSTAGING	
	WHERE 
		ISAPPROVED= '' or ISAPPROVED is null

UPDATE PWC_E_PMFFORMULAHEADERSTAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'PRODUCTIONSITEID is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_PMFFORMULAHEADERSTAGING	
	WHERE 
		PRODUCTIONSITEID= '' or PRODUCTIONSITEID is null

UPDATE PWC_E_PMFFORMULAHEADERSTAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'LegacyFormulaId is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_PMFFORMULAHEADERSTAGING	
	WHERE 
		LegacyFormulaId= '' or LegacyFormulaId is null

UPDATE PWC_E_PMFFORMULAHEADERSTAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'OldBOMCode is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_PMFFORMULAHEADERSTAGING	
	WHERE 
		OldBOMCode= '' or OldBOMCode is null

UPDATE PWC_E_PMFFORMULAHEADERSTAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'FORMULAID,DATAAREAID has duplicate values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_PMFFORMULAHEADERSTAGING	
	WHERE 
		FORMULAID IS NOT NULL AND CONCAT(FORMULAID,DATAAREAID) IN 
		(SELECT CONCAT(FORMULAID,DATAAREAID) FROM PWC_E_PMFFORMULAHEADERSTAGING
		GROUP BY FORMULAID,DATAAREAID HAVING COUNT(*)>1)

UPDATE PWC_E_PMFFORMULAHEADERSTAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'PRODUCTIONSITEID is not there in SITEID of Sites','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_PMFFORMULAHEADERSTAGING A	
	WHERE 
		PRODUCTIONSITEID IS NOT NULL AND PRODUCTIONSITEID NOT IN 
		(SELECT B.SITEID FROM PWC_E_SITEERP B WHERE  (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.SITEID IS NOT NULL)
















---- Formula Lines


UPDATE PWC_E_PMFFORMULALINEV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'ITEMNUMBER, PRODUCTUNITSYMBOL is not matching with Item Master','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_PMFFORMULALINEV2STAGING A
	WHERE
	ITEMNUMBER IS NOT NULL AND PRODUCTUNITSYMBOL IS NOT NULL AND CONCAT(ITEMNUMBER,PRODUCTUNITSYMBOL) NOT IN
	(SELECT CONCAT(B.ITEMNUMBER,B.BOMUNITSYMBOL) FROM PWC_E_ECORESRELEASEDPRODUCTV2STAGING B WHERE BOMUNITSYMBOL IS NOT NULL AND A.DATAAREAID = B.DATAAREAID)

UPDATE PWC_E_PMFFORMULALINEV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'FORMULAID is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_PMFFORMULALINEV2STAGING	
	WHERE 
		FORMULAID= '' or FORMULAID is null

UPDATE PWC_E_PMFFORMULALINEV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'ITEMNUMBER is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_PMFFORMULALINEV2STAGING	
	WHERE 
		ITEMNUMBER= '' or ITEMNUMBER is null

UPDATE PWC_E_PMFFORMULALINEV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'PRODUCTUNITSYMBOL is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_PMFFORMULALINEV2STAGING	
	WHERE 
		PRODUCTUNITSYMBOL= '' or PRODUCTUNITSYMBOL is null

UPDATE PWC_E_PMFFORMULALINEV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'CONSUMPTIONWAREHOUSEID is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_PMFFORMULALINEV2STAGING	
	WHERE 
		CONSUMPTIONWAREHOUSEID= '' or CONSUMPTIONWAREHOUSEID is null

 UPDATE PWC_E_PMFFORMULALINEV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'LINETYPE is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_PMFFORMULALINEV2STAGING	
	WHERE 
		LINETYPE= '' or LINETYPE is null

 UPDATE PWC_E_PMFFORMULALINEV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'QUANTITY is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_PMFFORMULALINEV2STAGING	
	WHERE 
		QUANTITY= '' or QUANTITY is null

UPDATE PWC_E_PMFFORMULALINEV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'LINETYPE has invalid enum values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_PMFFORMULALINEV2STAGING	
	WHERE 
		LINETYPE IS NOT NULL AND LINETYPE NOT IN
		(SELECT MEMBERNAME FROM RETAILENUMVALUETABLE WHERE ENUMNAME LIKE 'BOMType')



UPDATE PWC_E_PMFFORMULALINEV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'FORMULAID is not there in FORMULAID of Formula Headers','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_PMFFORMULALINEV2STAGING A	
	WHERE 
		FORMULAID IS NOT NULL AND FORMULAID NOT IN 
		(SELECT B.FORMULAID FROM PWC_E_PMFFORMULAHEADERSTAGING B WHERE  (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.FORMULAID IS NOT NULL)

UPDATE PWC_E_PMFFORMULALINEV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'ITEMNUMBER is not there in ITEMNUMBER of Item Master','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_PMFFORMULALINEV2STAGING A	
	WHERE 
		ITEMNUMBER IS NOT NULL AND ITEMNUMBER NOT IN 
		(SELECT B.ITEMNUMBER FROM PWC_E_ECORESRELEASEDPRODUCTV2STAGING B WHERE  (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.ITEMNUMBER IS NOT NULL)

UPDATE PWC_E_PMFFORMULALINEV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'PRODUCTUNITSYMBOL is not there in UnitSymbol of Units','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_PMFFORMULALINEV2STAGING A	
	WHERE 
		PRODUCTUNITSYMBOL IS NOT NULL AND PRODUCTUNITSYMBOL NOT IN 
		(SELECT B.UnitSymbol FROM PWC_E_UNIT B WHERE  (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.UnitSymbol IS NOT NULL)

UPDATE PWC_E_PMFFORMULALINEV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'CONSUMPTIONWAREHOUSEID is not there in WAREHOUSEID of Warehouses','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_PMFFORMULALINEV2STAGING A	
	WHERE 
		CONSUMPTIONWAREHOUSEID IS NOT NULL AND CONSUMPTIONWAREHOUSEID NOT IN 
		(SELECT B.WAREHOUSEID FROM PWC_E_WAREHOUSEERP B WHERE  (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.WAREHOUSEID IS NOT NULL)

















-----> Formula Versions

----------------------- check if these fields are present at least for some records -------------------

SELECT COUNT(*) FROM PWC_E_PMFFORMULAVERSIONV2STAGING
    WHERE 
    PWCDILUATIONFACTOR IS NOT NULL OR PWCDILUATIONFACTOR NOT LIKE ''

SELECT COUNT(*) FROM PWC_E_PMFFORMULAVERSIONV2STAGING
    WHERE 
    PWCDENSITY IS NOT NULL OR PWCDENSITY NOT LIKE ''

------------------------------------------------------------------------------------------------

UPDATE PWC_E_PMFFORMULAVERSIONV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'PWCDILUATIONFACTOR is not a real number','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_PMFFORMULAVERSIONV2STAGING
	WHERE PWCDILUATIONFACTOR IS NOT NULL AND PWCDILUATIONFACTOR LIKE '%[^0-9.]%'

UPDATE PWC_E_PMFFORMULAVERSIONV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'PWCDENSITY is not a real number','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_PMFFORMULAVERSIONV2STAGING
	WHERE PWCDENSITY IS NOT NULL AND PWCDENSITY LIKE '%[^0-9.]%'

 UPDATE PWC_E_PMFFORMULAVERSIONV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'FORMULAID is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_PMFFORMULAVERSIONV2STAGING	
	WHERE 
		FORMULAID= '' or FORMULAID is null

 UPDATE PWC_E_PMFFORMULAVERSIONV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'MANUFACTUREDITEMNUMBER is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_PMFFORMULAVERSIONV2STAGING	
	WHERE 
		MANUFACTUREDITEMNUMBER= '' or MANUFACTUREDITEMNUMBER is null

 UPDATE PWC_E_PMFFORMULAVERSIONV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'FORMULABATCHSIZE is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_PMFFORMULAVERSIONV2STAGING	
	WHERE 
		FORMULABATCHSIZE= '' or FORMULABATCHSIZE is null

 UPDATE PWC_E_PMFFORMULAVERSIONV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'ISACTIVE is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_PMFFORMULAVERSIONV2STAGING	
	WHERE 
		ISACTIVE= '' or ISACTIVE is null

 UPDATE PWC_E_PMFFORMULAVERSIONV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'ISAPPROVED is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_PMFFORMULAVERSIONV2STAGING	
	WHERE 
		ISAPPROVED= '' or ISAPPROVED is null

 UPDATE PWC_E_PMFFORMULAVERSIONV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'PRODUCTIONSITEID is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_PMFFORMULAVERSIONV2STAGING	
	WHERE 
		PRODUCTIONSITEID= '' or PRODUCTIONSITEID is null

 UPDATE PWC_E_PMFFORMULAVERSIONV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'VERSIONNAME is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_PMFFORMULAVERSIONV2STAGING	
	WHERE 
		VERSIONNAME= '' or VERSIONNAME is null

UPDATE PWC_E_PMFFORMULAVERSIONV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'Multiple versions active in the same period','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_PMFFORMULAVERSIONV2STAGING A
	WHERE 
		(MANUFACTUREDITEMNUMBER IS NOT NULL 
		AND VALIDFROMDATE IS NOT NULL
		AND VALIDTODATE IS NOT NULL 
		AND CONCAT(MANUFACTUREDITEMNUMBER,ISACTIVE, VALIDFROMDATE, VALIDTODATE, DATAAREAID) IN 
		(SELECT CONCAT(A.MANUFACTUREDITEMNUMBER,A.ISACTIVE, A.VALIDFROMDATE, A.VALIDTODATE, A.DATAAREAID)
		 FROM PWC_E_PMFFORMULAVERSIONV2STAGING A
		 JOIN PWC_E_PMFFORMULAVERSIONV2STAGING B ON A.MANUFACTUREDITEMNUMBER = B.MANUFACTUREDITEMNUMBER AND A.DATAAREAID = B.DATAAREAID
		 AND A.IsActive = 'Yes'
		 AND B.IsActive = 'Yes'
		 AND A.ValidFromDate <= B.ValidToDate
		 AND B.ValidFromDate <= A.ValidToDate
		 AND A.ValidFromDate <> B.ValidFromDate
		 AND A.ValidToDate <> B.ValidToDate
		)) OR
		(MANUFACTUREDITEMNUMBER IS NOT NULL 
		AND VALIDFROMDATE IS NULL
		AND VALIDTODATE IS NOT NULL 
		AND CONCAT(MANUFACTUREDITEMNUMBER,ISACTIVE, VALIDTODATE, DATAAREAID) IN 
		(SELECT CONCAT(A.MANUFACTUREDITEMNUMBER,A.ISACTIVE, A.VALIDTODATE, A.DATAAREAID)
		 FROM PWC_E_PMFFORMULAVERSIONV2STAGING A
		 JOIN PWC_E_PMFFORMULAVERSIONV2STAGING B ON A.MANUFACTUREDITEMNUMBER = B.MANUFACTUREDITEMNUMBER AND A.DATAAREAID = B.DATAAREAID
		 AND A.IsActive = 'Yes'
		 AND B.IsActive = 'Yes'
		 AND A.ValidToDate <> B.ValidToDate
		)) OR
		(MANUFACTUREDITEMNUMBER IS NOT NULL 
		AND VALIDFROMDATE IS NOT NULL
		AND VALIDTODATE IS NULL 
		AND CONCAT(MANUFACTUREDITEMNUMBER,ISACTIVE, VALIDFROMDATE, DATAAREAID) IN 
		(SELECT CONCAT(A.MANUFACTUREDITEMNUMBER,A.ISACTIVE, A.VALIDFROMDATE, A.DATAAREAID)
		 FROM PWC_E_PMFFORMULAVERSIONV2STAGING A
		 JOIN PWC_E_PMFFORMULAVERSIONV2STAGING B ON A.MANUFACTUREDITEMNUMBER = B.MANUFACTUREDITEMNUMBER AND A.DATAAREAID = B.DATAAREAID
		 AND A.IsActive = 'Yes'
		 AND B.IsActive = 'Yes'
		 AND A.ValidFromDate <> B.ValidFromDate
		)) OR
		(MANUFACTUREDITEMNUMBER IS NOT NULL 
		AND VALIDFROMDATE IS NULL
		AND VALIDTODATE IS NULL 
		AND CONCAT(MANUFACTUREDITEMNUMBER,ISACTIVE, VALIDFROMDATE, DATAAREAID) IN 
		(SELECT CONCAT(MANUFACTUREDITEMNUMBER, ISACTIVE, DATAAREAID) FROM PWC_E_PMFFORMULAVERSIONV2STAGING WHERE ISACTIVE = 'YES'
		GROUP BY MANUFACTUREDITEMNUMBER, ISACTIVE, DATAAREAID HAVING COUNT(*)>1))

UPDATE PWC_E_PMFFORMULAVERSIONV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'FORMULAID,DATAAREAID,MANUFACTUREDITEMNUMBER,VALIDFROMDATE has duplicate values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_PMFFORMULAVERSIONV2STAGING	
	WHERE 
		FORMULAID IS NOT NULL AND MANUFACTUREDITEMNUMBER IS NOT NULL AND VALIDFROMDATE IS NOT NULL AND CONCAT(FORMULAID,DATAAREAID,MANUFACTUREDITEMNUMBER,VALIDFROMDATE) IN 
		(SELECT CONCAT(FORMULAID,DATAAREAID,MANUFACTUREDITEMNUMBER,VALIDFROMDATE) FROM PWC_E_PMFFORMULAVERSIONV2STAGING
		GROUP BY FORMULAID,DATAAREAID,MANUFACTUREDITEMNUMBER,VALIDFROMDATE HAVING COUNT(*)>1)

UPDATE PWC_E_PMFFORMULAVERSIONV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'FORMULAID is not there in FORMULAID of Formula Headers','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_PMFFORMULAVERSIONV2STAGING A	
	WHERE 
		FORMULAID IS NOT NULL AND FORMULAID NOT IN 
		(SELECT B.FORMULAID FROM PWC_E_PMFFORMULAHEADERSTAGING B WHERE  (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.FORMULAID IS NOT NULL)

UPDATE PWC_E_PMFFORMULAVERSIONV2STAGING
	SET ERRORDESC = CONCAT(ERRORDESC,'MANUFACTUREDITEMNUMBER is not there in ITEMNUMBER of Item Master','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_PMFFORMULAVERSIONV2STAGING A	
	WHERE 
		MANUFACTUREDITEMNUMBER IS NOT NULL AND MANUFACTUREDITEMNUMBER NOT IN 
		(SELECT B.ITEMNUMBER FROM PWC_E_ECORESRELEASEDPRODUCTV2STAGING B WHERE  (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.ITEMNUMBER IS NOT NULL)







END
