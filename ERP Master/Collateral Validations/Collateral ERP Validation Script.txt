Collateral ERP Validation Script



Insurance and guarantees------

UPDATE PWC_E_CREDMANCUSTGUARANTEEINSURANCE
	SET ERRORDESC = CONCAT(ERRORDESC,'CUSTACCOUNT is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_CREDMANCUSTGUARANTEEINSURANCE 	
	WHERE 
		CUSTACCOUNT= '' or CUSTACCOUNT is null

UPDATE PWC_E_CREDMANCUSTGUARANTEEINSURANCE 
	SET ERRORDESC = CONCAT(ERRORDESC,'CURRENCYCODE is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_CREDMANCUSTGUARANTEEINSURANCE 	
	WHERE 
		CURRENCYCODE= '' or CURRENCYCODE is null

UPDATE PWC_E_CREDMANCUSTGUARANTEEINSURANCE
	SET ERRORDESC = CONCAT(ERRORDESC,'INSURANCECOVERAGETYPE should be blank when GUARANTEEINSURANCE is 'Guarantee'','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_CREDMANCUSTGUARANTEEINSURANCE 	
	WHERE 
		INSURANCECOVERAGETYPE is NOT null AND LOWER(GUARANTEEINSURANCE) LIKE 'guarantee'

 UPDATE PWC_E_CREDMANCUSTGUARANTEEINSURANCE 
	SET ERRORDESC = CONCAT(ERRORDESC,'CUSTACCOUNT,GUARANTEENUMBER,DATAAREAID has duplicate values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_CREDMANCUSTGUARANTEEINSURANCE	
	WHERE 
		CUSTACCOUNT IS NOT NULL AND GUARANTEENUMBER IS NOT NULL AND DATAAREAID IS NOT NULL AND CONCAT(CUSTACCOUNT,GUARANTEENUMBER,DATAAREAID) IN 
		(SELECT CONCAT(CUSTACCOUNT,GUARANTEENUMBER,DATAAREAID) FROM PWC_E_CREDMANCUSTGUARANTEEINSURANCE
		GROUP BY CUSTACCOUNT,GUARANTEENUMBER,DATAAREAID HAVING COUNT(*)>1)

 UPDATE PWC_E_CREDMANCUSTGUARANTEEINSURANCE 
	SET ERRORDESC = CONCAT(ERRORDESC,'GUARANTEEINSURANCE has invalid enum values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_CREDMANCUSTGUARANTEEINSURANCE	
	WHERE 
		GUARANTEEINSURANCE IS NOT NULL AND GUARANTEEINSURANCE NOT IN
		(SELECT MEMBERNAME FROM RETAILENUMVALUETABLE WHERE ENUMNAME LIKE 'CredManGuaranteeInsurance')

UPDATE PWC_E_CREDMANCUSTGUARANTEEINSURANCE
	SET ERRORDESC = CONCAT(ERRORDESC,'CURRENCYCODE is not in CURRENCYCODE of currencies','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_CREDMANCUSTGUARANTEEINSURANCE A
	WHERE
		CURRENCYCODE IS NOT NULL AND CURRENCYCODE NOT IN 
		(SELECT B.CURRENCYCODE FROM PWC_E_CURRENCIES B WHERE (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.CURRENCYCODE IS NOT NULL)

UPDATE PWC_E_CREDMANCUSTGUARANTEEINSURANCE
	SET ERRORDESC = CONCAT(ERRORDESC,'CUSTACCOUNT is not in CUSTOMERACCOUNT of Customer master','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_CREDMANCUSTGUARANTEEINSURANCE A
	WHERE
		CUSTACCOUNT IS NOT NULL AND CUSTACCOUNT NOT IN 
		(SELECT B.CUSTOMERACCOUNT FROM PWC_E_CUSTOMERV3 B WHERE (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.CUSTOMERACCOUNT IS NOT NULL)

UPDATE PWC_E_CREDMANCUSTGUARANTEEINSURANCE
	SET ERRORDESC = CONCAT(ERRORDESC,'GUARANTORINSURER is not in VENDORACCOUNTNUMBER of Vendor master','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_CREDMANCUSTGUARANTEEINSURANCE A
	WHERE
		GUARANTORINSURER IS NOT NULL AND GUARANTORINSURER NOT IN 
		(SELECT B.VENDORACCOUNTNUMBER FROM PWC_E_VENDOR B WHERE (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.VENDORACCOUNTNUMBER IS NOT NULL)

UPDATE PWC_E_CREDMANCUSTGUARANTEEINSURANCE
	SET ERRORDESC = CONCAT(ERRORDESC,'GUARANTEEINSURANCETYPE is not in Type of Insurance and guarantee types','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_CREDMANCUSTGUARANTEEINSURANCE A
	WHERE
		GUARANTEEINSURANCETYPE IS NOT NULL AND GUARANTEEINSURANCETYPE NOT IN 
		(SELECT B.Type FROM PWC_E_CREDMANGUARANTEEINSURANCETYPE B WHERE (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.Type IS NOT NULL)

UPDATE PWC_E_CREDMANCUSTGUARANTEEINSURANCE
	SET ERRORDESC = CONCAT(ERRORDESC,'INSURANCECOVERAGETYPE is not in Type of Coverage types entity','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_CREDMANCUSTGUARANTEEINSURANCE A
	WHERE
		INSURANCECOVERAGETYPE IS NOT NULL AND INSURANCECOVERAGETYPE NOT IN 
		(SELECT B.Type FROM PWC_E_CREDMANINSURANCECOVERAGETYPE B WHERE (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.Type IS NOT NULL)

UPDATE PWC_E_CREDMANCUSTGUARANTEEINSURANCE
	SET ERRORDESC = CONCAT(ERRORDESC,'VALIDTO HAS WRONG DATE FORMAT','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_CREDMANCUSTGUARANTEEINSURANCE 	
	WHERE 
		VALIDTO IS NOT NULL AND ISDATE(VALIDTO) = 0

 UPDATE PWC_E_CREDMANCUSTGUARANTEEINSURANCE
	SET ERRORDESC = CONCAT(ERRORDESC,'VALIDFROM HAS WRONG DATE FORMAT','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_CREDMANCUSTGUARANTEEINSURANCE 	
	WHERE 
		VALIDFROM IS NOT NULL AND ISDATE(VALIDFROM) = 0

 UPDATE PWC_E_CREDMANCUSTGUARANTEEINSURANCE
	SET ERRORDESC = CONCAT(ERRORDESC,'VALIDTO is less than VALIDFROM','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_CREDMANCUSTGUARANTEEINSURANCE 	
	WHERE 
		VALIDTO is not NULL and VALIDFROM is not NULL and (VALIDTO < VALIDFROM)

UPDATE PWC_E_CREDMANCUSTGUARANTEEINSURANCE
	SET ERRORDESC2 = CONCAT(ERRORDESC2,'VALUE is not a real number','; ')
	,ERRORSTATUS2 = CONCAT(ERRORSTATUS2, 'Constraint', '; ')
	FROM PWC_E_CREDMANCUSTGUARANTEEINSURANCE
	WHERE
		VALUE LIKE '%[^0-9.]%'

UPDATE PWC_E_CREDMANCUSTGUARANTEEINSURANCE
	SET ERRORDESC2 = CONCAT(ERRORDESC2,'INCREASECREDITLIMITPERCENT is not a real number','; ')
	,ERRORSTATUS2 = CONCAT(ERRORSTATUS2, 'Constraint', '; ')
	FROM PWC_E_CREDMANCUSTGUARANTEEINSURANCE
	WHERE
		INCREASECREDITLIMITPERCENT LIKE '%[^0-9.]%'




Insurance and guarantee types----

UPDATE PWC_E_CREDMANGUARANTEEINSURANCETYPE
	SET ERRORDESC = CONCAT(ERRORDESC,'TYPE is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_CREDMANGUARANTEEINSURANCETYPE
	WHERE 
		TYPE= '' or TYPE is null

UPDATE PWC_E_CREDMANGUARANTEEINSURANCETYPE
	SET ERRORDESC = CONCAT(ERRORDESC,'DESCRIPTION is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_CREDMANGUARANTEEINSURANCETYPE
	WHERE 
		DESCRIPTION= '' or DESCRIPTION is null

 UPDATE PWC_E_CREDMANGUARANTEEINSURANCETYPE 
	SET ERRORDESC = CONCAT(ERRORDESC,'TYPE,DATAAREAID has duplicate values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_CREDMANGUARANTEEINSURANCETYPE
	WHERE 
		TYPE IS NOT NULL AND DATAAREAID IS NOT NULL AND CONCAT(TYPE,DATAAREAID) IN 
		(SELECT CONCAT(TYPE,DATAAREAID) FROM PWC_E_CREDMANGUARANTEEINSURANCETYPE
		GROUP BY TYPE,DATAAREAID HAVING COUNT(*)>1)



Coverage types----

UPDATE PWC_E_CREDMANINSURANCECOVERAGETYPE
	SET ERRORDESC = CONCAT(ERRORDESC,'TYPE is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_CREDMANINSURANCECOVERAGETYPE
	WHERE 
		TYPE= '' or TYPE is null

UPDATE PWC_E_CREDMANINSURANCECOVERAGETYPE
	SET ERRORDESC = CONCAT(ERRORDESC,'DESCRIPTION is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_CREDMANINSURANCECOVERAGETYPE
	WHERE 
		DESCRIPTION= '' or DESCRIPTION is null

 UPDATE PWC_E_CREDMANINSURANCECOVERAGETYPE 
	SET ERRORDESC = CONCAT(ERRORDESC,'TYPE,DATAAREAID has duplicate values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_CREDMANINSURANCECOVERAGETYPE
	WHERE
		TYPE IS NOT NULL AND DATAAREAID IS NOT NULL AND CONCAT(TYPE,DATAAREAID) IN 
		(SELECT CONCAT(TYPE,DATAAREAID) FROM PWC_E_CREDMANINSURANCECOVERAGETYPE
		GROUP BY TYPE,DATAAREAID HAVING COUNT(*)>1)
