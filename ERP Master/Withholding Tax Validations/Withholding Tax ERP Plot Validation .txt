Withholding Tax ERP Pilot Validation


----------------------------- Validation Rules ------------------------------

WITHHOLDINGCODE is null --- Error --- 2
CURRENCYCODEID is null --- Warning --- 3
WITHHOLDINGTAXBASE is null --- Warning --- 3
WITHHOLDINGTAXNAME is null --- Warning --- 3
WITHHOLDINGTAXROUNDOFF is null --- Warning --- 3
WITHHOLDINGTAXROUNDOFFTYPE is null --- Warning --- 3
MAINACCOUNTIDDISPLAYVALUE is null --- Warning --- 3

WITHHOLDINGCODE has duplicate values --- Constraint --- 1

TaxWithholdBaseType
WITHHOLDINGTAXBASE has invalid enum values --- Error --- 2
RoundOffType
WITHHOLDINGTAXROUNDOFFTYPE has invalid enum values --- Error --- 2


CURRENCYCODEID is not there in CURRENCYCODE of currencies --- Error --- 2
MAINACCOUNTIDDISPLAYVALUE is not there in MAINACCOUNTID of Main Account --- Error --- 2



---Withholding Tax Groups
WITHHOLDINGTAXGROUPCODE is blank --- Error --- 2
DESCRIPTION is blank --- Warning --- 3
WITHHOLDINGTAXGROUPCODE has duplicate values --- Constraint --- 1


---Withholding tax code values
TAXWITHHOLDCODEID is blank --- Error --- 2
FROMDATE is blank --- Error --- 2
TODATE is blank --- Error --- 2
VALUE is blank --- Warning --- 3
TAXWITHHOLDCODEID,FROMDATE,TODATE has duplicate values --- Constraint --- 1
TAXWITHHOLDCODEID is not there in WITHHOLDINGCODE of Withholding Tax Code --- Error --- 2


---Item withholding tax group
TAXWITHHOLDITEMGROUP is blank --- Error --- 2
TAXWITHHOLDCODE is blank --- Error --- 2
NAME is blank --- Warning --- 3
TAXWITHHOLDITEMGROUP,TAXWITHHOLDCODE has duplicate values --- Constraint --- 1
TAXWITHHOLDCODE is not there in WITHHOLDINGCODE of Withholding Tax Code --- Error --- 2









------------------------ Validation Scripts ---------------------------


----------- Withholding Tax Code

UPDATE PWC_E_WITHHOLDINGTAXCODE
	SET ERRORDESC = CONCAT(ERRORDESC,'WITHHOLDINGCODE is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODE 
	WHERE 
		WITHHOLDINGCODE= '' or WITHHOLDINGCODE is null

UPDATE PWC_E_WITHHOLDINGTAXCODE
	SET ERRORDESC = CONCAT(ERRORDESC,'CURRENCYCODEID is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODE 
	WHERE 
		CURRENCYCODEID= '' or CURRENCYCODEID is null

UPDATE PWC_E_WITHHOLDINGTAXCODE
	SET ERRORDESC = CONCAT(ERRORDESC,'WITHHOLDINGTAXBASE is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODE 
	WHERE 
		WITHHOLDINGTAXBASE= '' or WITHHOLDINGTAXBASE is null

UPDATE PWC_E_WITHHOLDINGTAXCODE
	SET ERRORDESC = CONCAT(ERRORDESC,'WITHHOLDINGTAXNAME is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODE 
	WHERE 
		WITHHOLDINGTAXNAME= '' or WITHHOLDINGTAXNAME is null

UPDATE PWC_E_WITHHOLDINGTAXCODE
	SET ERRORDESC = CONCAT(ERRORDESC,'WITHHOLDINGTAXROUNDOFF is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODE 
	WHERE 
		WITHHOLDINGTAXROUNDOFF= '' or WITHHOLDINGTAXROUNDOFF is null

UPDATE PWC_E_WITHHOLDINGTAXCODE
	SET ERRORDESC = CONCAT(ERRORDESC,'WITHHOLDINGTAXROUNDOFFTYPE is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODE 
	WHERE 
		WITHHOLDINGTAXROUNDOFFTYPE= '' or WITHHOLDINGTAXROUNDOFFTYPE is null

UPDATE PWC_E_WITHHOLDINGTAXCODE
	SET ERRORDESC = CONCAT(ERRORDESC,'MAINACCOUNTIDDISPLAYVALUE is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODE 
	WHERE 
		MAINACCOUNTIDDISPLAYVALUE= '' or MAINACCOUNTIDDISPLAYVALUE is null

UPDATE PWC_E_WITHHOLDINGTAXCODE
	SET ERRORDESC = CONCAT(ERRORDESC,'WITHHOLDINGCODE,DATAAREAID has duplicate values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODE
	WHERE 
		WITHHOLDINGCODE IS NOT NULL AND DATAAREAID IS NOT NULL AND CONCAT(WITHHOLDINGCODE,DATAAREAID) IN 
		(SELECT CONCAT(WITHHOLDINGCODE,DATAAREAID) FROM PWC_E_WITHHOLDINGTAXCODE
		GROUP BY WITHHOLDINGCODE,DATAAREAID HAVING COUNT(*)>1)

UPDATE PWC_E_WITHHOLDINGTAXCODE
	SET ERRORDESC = CONCAT(ERRORDESC,'WITHHOLDINGTAXBASE has invalid enum values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODE 
	WHERE 
		WITHHOLDINGTAXBASE IS NOT NULL AND WITHHOLDINGTAXBASE NOT IN
		(SELECT MEMBERNAME FROM RETAILENUMVALUETABLE WHERE ENUMNAME LIKE 'TaxWithholdBaseType')

UPDATE PWC_E_WITHHOLDINGTAXCODE
	SET ERRORDESC = CONCAT(ERRORDESC,'WITHHOLDINGTAXROUNDOFFTYPE has invalid enum values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODE 
	WHERE 
		WITHHOLDINGTAXROUNDOFFTYPE IS NOT NULL AND WITHHOLDINGTAXROUNDOFFTYPE NOT IN
		(SELECT MEMBERNAME FROM RETAILENUMVALUETABLE WHERE ENUMNAME LIKE 'RoundOffType')

UPDATE PWC_E_WITHHOLDINGTAXCODE
	SET ERRORDESC = CONCAT(ERRORDESC,'CURRENCYCODEID is not there in CURRENCYCODE of currencies','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODE A
	WHERE
		CURRENCYCODEID IS NOT NULL AND CURRENCYCODEID NOT IN
		(SELECT B.CURRENCYCODE FROM PWC_E_CURRENCIES B WHERE B.ErrorDesc IS NULL AND B.ErrorDesc2 IS NULL AND (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.CURRENCYCODE IS NOT NULL)

UPDATE PWC_E_WITHHOLDINGTAXCODE
	SET ERRORDESC = CONCAT(ERRORDESC,'MAINACCOUNTIDDISPLAYVALUE is not there in MAINACCOUNTID of Main Account','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODE A
	WHERE
		MAINACCOUNTIDDISPLAYVALUE IS NOT NULL AND MAINACCOUNTIDDISPLAYVALUE NOT IN
		(SELECT B.MAINACCOUNTID FROM PWC_E_MAINACCOUNT B WHERE B.ErrorDesc IS NULL AND B.ErrorDesc2 IS NULL AND (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.MAINACCOUNTID IS NOT NULL)





---Withholding Tax Groups

UPDATE PWC_E_WITHHOLDINGTAXGROUP
	SET ERRORDESC = CONCAT(ERRORDESC,'WITHHOLDINGTAXGROUPCODE is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_WITHHOLDINGTAXGROUP
	WHERE 
		WITHHOLDINGTAXGROUPCODE= '' or WITHHOLDINGTAXGROUPCODE is null

UPDATE PWC_E_WITHHOLDINGTAXGROUP
	SET ERRORDESC = CONCAT(ERRORDESC,'DESCRIPTION is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_WITHHOLDINGTAXGROUP
	WHERE 
		DESCRIPTION= '' or DESCRIPTION is null

UPDATE PWC_E_WITHHOLDINGTAXGROUP
	SET ERRORDESC = CONCAT(ERRORDESC,'WITHHOLDINGTAXGROUPCODE,DATAAREAID has duplicate values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_WITHHOLDINGTAXGROUP
	WHERE 
		WITHHOLDINGTAXGROUPCODE IS NOT NULL AND DATAAREAID IS NOT NULL AND CONCAT(WITHHOLDINGTAXGROUPCODE,DATAAREAID) IN 
		(SELECT CONCAT(WITHHOLDINGTAXGROUPCODE,DATAAREAID) FROM PWC_E_WITHHOLDINGTAXGROUP
		GROUP BY WITHHOLDINGTAXGROUPCODE,DATAAREAID HAVING COUNT(*)>1)




---Withholding tax code values

UPDATE PWC_E_WITHHOLDINGTAXCODEVALUES
	SET ERRORDESC = CONCAT(ERRORDESC,'TAXWITHHOLDCODEID is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODEVALUES
	WHERE 
		TAXWITHHOLDCODEID= '' or TAXWITHHOLDCODEID is null

UPDATE PWC_E_WITHHOLDINGTAXCODEVALUES
	SET ERRORDESC = CONCAT(ERRORDESC,'FROMDATE is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODEVALUES
	WHERE 
		FROMDATE= '' or FROMDATE is null

UPDATE PWC_E_WITHHOLDINGTAXCODEVALUES
	SET ERRORDESC = CONCAT(ERRORDESC,'TODATE is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODEVALUES
	WHERE 
		TODATE= '' or TODATE is null

UPDATE PWC_E_WITHHOLDINGTAXCODEVALUES
	SET ERRORDESC = CONCAT(ERRORDESC,'VALUE is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODEVALUES
	WHERE 
		VALUE= '' or VALUE is null

UPDATE PWC_E_WITHHOLDINGTAXCODEVALUES
	SET ERRORDESC = CONCAT(ERRORDESC,'TAXWITHHOLDCODEID,FROMDATE,TODATE,DATAAREAID has duplicate values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODEVALUES
	WHERE 
		TAXWITHHOLDCODEID IS NOT NULL AND FROMDATE IS NOT NULL AND TODATE IS NOT NULL AND DATAAREAID IS NOT NULL AND  CONCAT(TAXWITHHOLDCODEID,FROMDATE,TODATE,DATAAREAID) IN 
		(SELECT CONCAT(TAXWITHHOLDCODEID,FROMDATE,TODATE,DATAAREAID) FROM PWC_E_WITHHOLDINGTAXCODEVALUES
		GROUP BY CONCAT(TAXWITHHOLDCODEID,FROMDATE,TODATE,DATAAREAID) HAVING COUNT(*)>1)


UPDATE PWC_E_WITHHOLDINGTAXCODEVALUES
	SET ERRORDESC = CONCAT(ERRORDESC,'TAXWITHHOLDCODEID is not there in WITHHOLDINGCODE of Withholding Tax Code','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_WITHHOLDINGTAXCODEVALUES A
	WHERE 
		TAXWITHHOLDCODEID IS NOT NULL AND TAXWITHHOLDCODEID NOT IN 
		(SELECT B.WITHHOLDINGCODE FROM PWC_E_WITHHOLDINGTAXCODE B WHERE B.ErrorDesc IS NULL AND B.ErrorDesc2 IS NULL AND (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.WITHHOLDINGCODE IS NOT NULL)




---Item withholding tax group

UPDATE PWC_E_ITEMWITHHOLDINGAXGROUP
	SET ERRORDESC = CONCAT(ERRORDESC,'TAXWITHHOLDITEMGROUP is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_ITEMWITHHOLDINGAXGROUP
	WHERE 
		TAXWITHHOLDITEMGROUP= '' or TAXWITHHOLDITEMGROUP is null

UPDATE PWC_E_ITEMWITHHOLDINGAXGROUP
	SET ERRORDESC = CONCAT(ERRORDESC,'TAXWITHHOLDCODE is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_ITEMWITHHOLDINGAXGROUP
	WHERE 
		TAXWITHHOLDCODE= '' or TAXWITHHOLDCODE is null

UPDATE PWC_E_ITEMWITHHOLDINGAXGROUP
	SET ERRORDESC = CONCAT(ERRORDESC,'NAME is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_ITEMWITHHOLDINGAXGROUP
	WHERE 
		NAME= '' or NAME is null

UPDATE PWC_E_ITEMWITHHOLDINGAXGROUP
	SET ERRORDESC = CONCAT(ERRORDESC,'TAXWITHHOLDITEMGROUP,TAXWITHHOLDCODE,DATAAREAID has duplicate values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_ITEMWITHHOLDINGAXGROUP
	WHERE 
		TAXWITHHOLDITEMGROUP IS NOT NULL AND TAXWITHHOLDCODE IS NOT NULL AND DATAAREAID IS NOT NULL AND CONCAT(TAXWITHHOLDITEMGROUP,TAXWITHHOLDCODE,DATAAREAID) IN 
		(SELECT CONCAT(TAXWITHHOLDITEMGROUP,TAXWITHHOLDCODE,DATAAREAID) FROM PWC_E_ITEMWITHHOLDINGAXGROUP
		GROUP BY CONCAT(TAXWITHHOLDITEMGROUP,TAXWITHHOLDCODE,DATAAREAID) HAVING COUNT(*)>1)


UPDATE PWC_E_ITEMWITHHOLDINGAXGROUP
	SET ERRORDESC = CONCAT(ERRORDESC,'TAXWITHHOLDCODE is not there in WITHHOLDINGCODE of Withholding Tax Code','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_ITEMWITHHOLDINGAXGROUP A
	WHERE 
		TAXWITHHOLDCODE IS NOT NULL AND TAXWITHHOLDCODE NOT IN 
		(SELECT B.WITHHOLDINGCODE FROM PWC_E_WITHHOLDINGTAXCODE B WHERE B.ErrorDesc IS NULL AND B.ErrorDesc2 IS NULL AND (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.WITHHOLDINGCODE IS NOT NULL)



