Intercompany ERP Validation 

--------------------------------- Validation Rules ---------------------------

----> Intercompany Trading Partnership

CUSTOMERLEGALENTITYID is null --- Error --- 2
CUSTOMERACCOUNTNUMBER is null --- Error --- 2
VENDORLEGALENTITYID is null --- Error --- 2
VENDORACCOUNTNUMBER is null --- Error --- 2
ISTRADINGPARTNERSHIPACTIVE is null --- Warning --- 3

CUSTOMERLEGALENTITYID,CUSTOMERACCOUNTNUMBER,VENDORLEGALENTITYID,VENDORACCOUNTNUMBER has duplicate values --- Constraint --- 1

CUSTOMERLEGALENTITYID is not there in LEGALENTITYID of legal entities --- Error --- 2
CUSTOMERACCOUNTNUMBER is not there in CUSTOMERACCOUNT of Customer --- Error --- 2
VENDORLEGALENTITYID is not there in LEGALENTITYID of legal entities --- Error --- 2
VENDORACCOUNTNUMBER is not there in VENDORACCOUNTNUMBER of Vendor --- Error --- 2











-------------------------------------- Validation Script ------------------------------------

----> Intercompany Trading Partnership

UPDATE PWC_E_INTERCOMPTRADINGPARTNERSHIP 
	SET ERRORDESC = CONCAT(ERRORDESC,'CUSTOMERLEGALENTITYID is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_INTERCOMPTRADINGPARTNERSHIP	
	WHERE 
		CUSTOMERLEGALENTITYID= '' or CUSTOMERLEGALENTITYID is null

UPDATE PWC_E_INTERCOMPTRADINGPARTNERSHIP 
	SET ERRORDESC = CONCAT(ERRORDESC,'CUSTOMERACCOUNTNUMBER is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_INTERCOMPTRADINGPARTNERSHIP	
	WHERE 
		CUSTOMERACCOUNTNUMBER= '' or CUSTOMERACCOUNTNUMBER is null

UPDATE PWC_E_INTERCOMPTRADINGPARTNERSHIP 
	SET ERRORDESC = CONCAT(ERRORDESC,'VENDORLEGALENTITYID is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_INTERCOMPTRADINGPARTNERSHIP	
	WHERE 
		VENDORLEGALENTITYID= '' or VENDORLEGALENTITYID is null

UPDATE PWC_E_INTERCOMPTRADINGPARTNERSHIP 
	SET ERRORDESC = CONCAT(ERRORDESC,'VENDORACCOUNTNUMBER is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_INTERCOMPTRADINGPARTNERSHIP	
	WHERE 
		VENDORACCOUNTNUMBER= '' or VENDORACCOUNTNUMBER is null

UPDATE PWC_E_INTERCOMPTRADINGPARTNERSHIP 
	SET ERRORDESC = CONCAT(ERRORDESC,'ISTRADINGPARTNERSHIPACTIVE is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_INTERCOMPTRADINGPARTNERSHIP	
	WHERE 
		ISTRADINGPARTNERSHIPACTIVE= '' or ISTRADINGPARTNERSHIPACTIVE is null

UPDATE PWC_E_INTERCOMPTRADINGPARTNERSHIP
	SET ERRORDESC = CONCAT(ERRORDESC,'CUSTOMERLEGALENTITYID,CUSTOMERACCOUNTNUMBER,DATAAREAID has duplicate values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_INTERCOMPTRADINGPARTNERSHIP
	WHERE 
		CUSTOMERLEGALENTITYID IS NOT NULL AND 
		CUSTOMERACCOUNTNUMBER IS NOT NULL AND 
		DATAAREAID IS NOT NULL AND
		CONCAT(CUSTOMERLEGALENTITYID,CUSTOMERACCOUNTNUMBER,DATAAREAID) IN 
		(SELECT CONCAT(CUSTOMERLEGALENTITYID,CUSTOMERACCOUNTNUMBER,DATAAREAID) FROM PWC_E_INTERCOMPTRADINGPARTNERSHIP
		GROUP BY CUSTOMERLEGALENTITYID,CUSTOMERACCOUNTNUMBER,DATAAREAID HAVING COUNT(*)>1)

UPDATE PWC_E_INTERCOMPTRADINGPARTNERSHIP
	SET ERRORDESC = CONCAT(ERRORDESC,'VENDORLEGALENTITYID,VENDORACCOUNTNUMBER,DATAAREAID has duplicate values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_INTERCOMPTRADINGPARTNERSHIP
	WHERE 
		VENDORLEGALENTITYID IS NOT NULL AND
		VENDORACCOUNTNUMBER IS NOT NULL AND
		DATAAREAID IS NOT NULL AND
		CONCAT(VENDORLEGALENTITYID,VENDORACCOUNTNUMBER,DATAAREAID) IN 
		(SELECT CONCAT(VENDORLEGALENTITYID,VENDORACCOUNTNUMBER,DATAAREAID) FROM PWC_E_INTERCOMPTRADINGPARTNERSHIP
		GROUP BY VENDORLEGALENTITYID,VENDORACCOUNTNUMBER,DATAAREAID HAVING COUNT(*)>1)    

UPDATE PWC_E_INTERCOMPTRADINGPARTNERSHIP
	SET ERRORDESC = CONCAT(ERRORDESC,'CUSTOMERLEGALENTITYID,CUSTOMERACCOUNTNUMBER,VENDORLEGALENTITYID,VENDORACCOUNTNUMBER,DATAAREAID has duplicate values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_INTERCOMPTRADINGPARTNERSHIP
	WHERE 
		CUSTOMERLEGALENTITYID IS NOT NULL AND 
		CUSTOMERACCOUNTNUMBER IS NOT NULL AND 
		VENDORLEGALENTITYID IS NOT NULL AND
		VENDORACCOUNTNUMBER IS NOT NULL AND
		DATAAREAID IS NOT NULL AND
		CONCAT(CUSTOMERLEGALENTITYID,CUSTOMERACCOUNTNUMBER,VENDORLEGALENTITYID,VENDORACCOUNTNUMBER,DATAAREAID) IN 
		(SELECT CONCAT(CUSTOMERLEGALENTITYID,CUSTOMERACCOUNTNUMBER,VENDORLEGALENTITYID,VENDORACCOUNTNUMBER,DATAAREAID) FROM PWC_E_INTERCOMPTRADINGPARTNERSHIP
		GROUP BY CUSTOMERLEGALENTITYID,CUSTOMERACCOUNTNUMBER,VENDORLEGALENTITYID,VENDORACCOUNTNUMBER,DATAAREAID HAVING COUNT(*)>1)

UPDATE PWC_E_INTERCOMPTRADINGPARTNERSHIP 
	SET ERRORDESC = CONCAT(ERRORDESC,'CUSTOMERLEGALENTITYID is not there in LEGALENTITYID of legal entities','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_INTERCOMPTRADINGPARTNERSHIP A
	WHERE 
		CUSTOMERLEGALENTITYID IS NOT NULL AND CUSTOMERLEGALENTITYID NOT IN 
		(SELECT B.LEGALENTITYID FROM PWC_E_LEGALENTITY B WHERE  (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.LEGALENTITYID IS NOT NULL)

UPDATE PWC_E_INTERCOMPTRADINGPARTNERSHIP 
	SET ERRORDESC = CONCAT(ERRORDESC,'CUSTOMERACCOUNTNUMBER is not there in CUSTOMERACCOUNT of Customer','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_INTERCOMPTRADINGPARTNERSHIP A
	WHERE 
		CUSTOMERACCOUNTNUMBER IS NOT NULL AND CUSTOMERACCOUNTNUMBER NOT IN 
		(SELECT B.CustomerCodeLegacy FROM PWC_E_CUSTOMERV3 B WHERE  (B.DATAAREAID = A.CUSTOMERLEGALENTITYID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.CustomerCodeLegacy IS NOT NULL)

UPDATE PWC_E_INTERCOMPTRADINGPARTNERSHIP 
	SET ERRORDESC = CONCAT(ERRORDESC,'VENDORLEGALENTITYID is not there in LEGALENTITYID of legal entities','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_INTERCOMPTRADINGPARTNERSHIP A
	WHERE 
		VENDORLEGALENTITYID IS NOT NULL AND VENDORLEGALENTITYID NOT IN 
		(SELECT B.LEGALENTITYID FROM PWC_E_LEGALENTITY B WHERE  (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.LEGALENTITYID IS NOT NULL)

UPDATE PWC_E_INTERCOMPTRADINGPARTNERSHIP 
	SET ERRORDESC = CONCAT(ERRORDESC,'VENDORACCOUNTNUMBER is not there in VENDORACCOUNTNUMBER of Vendor','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_INTERCOMPTRADINGPARTNERSHIP	A
	WHERE 
		VENDORACCOUNTNUMBER IS NOT NULL AND VENDORACCOUNTNUMBER NOT IN 
		(SELECT B.VENDORACCOUNTNUMBER FROM PWC_E_VENDOR B WHERE  (B.DATAAREAID = A.VENDORLEGALENTITYID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.VENDORACCOUNTNUMBER IS NOT NULL)




















