Route Details ERP Validation script

Route Details----


 UPDATE PWC_E_ROUTEDETAILS
	SET ERRORDESC = CONCAT(ERRORDESC,'InventSiteId,RouteCode,DATAAREAID has duplicate values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_ROUTEDETAILS
	WHERE 
		InventSiteId IS NOT NULL AND RouteCode IS NOT NULL AND DATAAREAID IS NOT NULL AND CONCAT(InventSiteId,RouteCode,DATAAREAID) IN 
		(SELECT CONCAT(InventSiteId,RouteCode,DATAAREAID) FROM PWC_E_ROUTEDETAILS
		GROUP BY InventSiteId,RouteCode,DATAAREAID HAVING COUNT(*)>1)

 UPDATE PWC_E_ROUTEDETAILS
	SET ERRORDESC = CONCAT(ERRORDESC,'IsActive has invalid enum values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_ROUTEDETAILS	
	WHERE 
		IsActive IS NOT NULL AND IsActive NOT IN
		(SELECT MEMBERNAME FROM RETAILENUMVALUETABLE WHERE ENUMNAME LIKE 'PwCIsActive')

 UPDATE PWC_E_ROUTEDETAILS
	SET ERRORDESC = CONCAT(ERRORDESC,'Sector has invalid enum values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_ROUTEDETAILS	
	WHERE 
		Sector IS NOT NULL AND Sector NOT IN
		(SELECT MEMBERNAME FROM RETAILENUMVALUETABLE WHERE ENUMNAME LIKE 'PwCSector')

 UPDATE PWC_E_ROUTEDETAILS
	SET ERRORDESC = CONCAT(ERRORDESC,'RouteType has invalid enum values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_ROUTEDETAILS	
	WHERE 
		RouteType IS NOT NULL AND RouteType NOT IN
		(SELECT MEMBERNAME FROM RETAILENUMVALUETABLE WHERE ENUMNAME LIKE 'PwCRouteType')

UPDATE PWC_E_ROUTEDETAILS
	SET ERRORDESC = CONCAT(ERRORDESC,'DataAreaId is not in LEGALENTITYID of legal entities','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_ROUTEDETAILS A
	WHERE
		DataAreaId IS NOT NULL AND DataAreaId NOT IN 
		(SELECT B.LEGALENTITYID FROM PWC_E_LEGALENTITY B WHERE (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.LEGALENTITYID IS NOT NULL)

UPDATE PWC_E_ROUTEDETAILS
	SET ERRORDESC = CONCAT(ERRORDESC,'AuthorizedItemCode is not in ITEMNUMBER of Item Master','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_ROUTEDETAILS A
	WHERE
		AuthorizedItemCode IS NOT NULL AND AuthorizedItemCode NOT IN 
		(SELECT B.ITEMNUMBER FROM PWC_E_ECORESRELEASEDPRODUCTV2STAGING B WHERE (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.ITEMNUMBER IS NOT NULL)

UPDATE PWC_E_ROUTEDETAILS
	SET ERRORDESC = CONCAT(ERRORDESC,'InventSiteId is not in SITEID of Site Master','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_ROUTEDETAILS A
	WHERE
		InventSiteId IS NOT NULL AND InventSiteId NOT IN 
		(SELECT B.SITEID FROM PWC_E_SITEERP B WHERE (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.SITEID IS NOT NULL)

UPDATE PWC_E_ROUTEDETAILS
	SET ERRORDESC = CONCAT(ERRORDESC,'SalesmanCode is not in PERSONNELNUMBER of Employee Master','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	 FROM PWC_E_ROUTEDETAILS A
	WHERE
		SalesmanCode IS NOT NULL AND SalesmanCode NOT IN 
		(SELECT B.PERSONNELNUMBER FROM PWC_E_EMPLOYEE B Join PWC_E_HCMPOSITIONV2STAGING C on C.WorkerPersonnelNumber = B.PERSONNELNUMBER WHERE (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.PERSONNELNUMBER IS NOT NULL AND UPPER(C.PwCIsSalesPerson) = 'YES')

UPDATE PWC_E_ROUTEDETAILS
	SET ERRORDESC = CONCAT(ERRORDESC,'WarehouseCode is not in WAREHOUSEID of Warehouse Master','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_ROUTEDETAILS A
	WHERE
		WarehouseCode IS NOT NULL AND WarehouseCode NOT IN 
		(SELECT B.WAREHOUSEID FROM PWC_E_WAREHOUSEERP B WHERE (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.WAREHOUSEID IS NOT NULL)

UPDATE PWC_E_ROUTEDETAILS
	SET ERRORDESC = CONCAT(ERRORDESC,'AuthorizedWarehouseCode is not in WAREHOUSEID of Warehouse Master','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_ROUTEDETAILS A
	WHERE
		AuthorizedWarehouseCode IS NOT NULL AND AuthorizedWarehouseCode NOT IN 
		(SELECT B.WAREHOUSEID FROM PWC_E_WAREHOUSEERP B WHERE (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.WAREHOUSEID IS NOT NULL)

UPDATE PWC_E_ROUTEDETAILS
	SET ERRORDESC = CONCAT(ERRORDESC,'DefaultCashCustomer is not in CUSTOMERACCOUNT of Customer Master','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_ROUTEDETAILS A
	WHERE
		DefaultCashCustomer IS NOT NULL AND DefaultCashCustomer NOT IN 
		(SELECT B.CUSTOMERACCOUNT FROM PWC_E_CUSTOMERV3 B WHERE (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.CUSTOMERACCOUNT IS NOT NULL)

UPDATE PWC_E_ROUTEDETAILS
	SET ERRORDESC = CONCAT(ERRORDESC,'RouteCode is not present in WAREHOUSELOCATIONID of Warehouse Locations for the respective WarehouseCode','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_ROUTEDETAILS A
	WHERE
		RouteCode IS NOT NULL AND RouteCode NOT IN 
		(SELECT B.WAREHOUSELOCATIONID FROM PWC_E_WAREHOUSEERP B WHERE (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL'  OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.WAREHOUSEID = A.WarehouseCode)

UPDATE PWC_E_ROUTEDETAILS
	SET ERRORDESC2 = CONCAT(ERRORDESC2,'CreditLimit is not a real number','; ')
	,ERRORSTATUS2 = CONCAT(ERRORSTATUS2, 'Constraint', '; ')
	FROM PWC_E_ORDERQUANTVEND
	WHERE
		CreditLimit LIKE '%[^0-9.]%'