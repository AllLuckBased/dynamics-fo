Financial Period Close Template Tasks ERP Pilot Validation Script


Financial period close template tasks----

Template is blank --- Error --- 2
Task is blank --- Error --- 2
TaskLink is blank --- Warning --- 3
TargetDaysFromProjectComplete is blank --- Warning --- 3
DueTime is blank --- Warning --- 3
LineNumber is blank --- Warning --- 3
Area is blank --- Warning --- 3
ClosingRole is blank --- Warning --- 3
TaskLinkType is blank --- Warning --- 3
CompanySelection is blank --- Warning --- 3

Area is not there in NAME of Area --- Error --- 2
ClosingRole is not there in NAME of Closing Role --- Error --- 2

LedgerPeriodCloseTaskAction
TaskLinkType enum does not have valid enum values --- Error --- 2

Template,LineNumber,DATAAREAID has duplicate values --- Constraint --- 1


Area----

NAME is blank --- Warning --- 3
DESCRIPTION is blank --- Warning --- 3

NAME,DATAAREAID has duplicate values --- Constraint --- 1




Closing Roles----
 
NAME is blank --- Warning --- 3
DESCRIPTION is blank --- Warning --- 3

NAME,DATAAREAID has duplicate values --- Constraint --- 1



---------------------------- Validations Scripts ----------------------------------


Financial period close template tasks----

DECLARE @Time Nvarchar(15)  
SELECT @Time = DueTime FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK
UPDATE PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	SET ERRORDESC = CONCAT(ERRORDESC, 'DueTime HAS WRONG TIME FORMAT','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'ERROR', '; ')
	FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	WHERE
		DueTime IS NOT NULL AND
		(ISNUMERIC(REPLACE(@Time,':','')) = 0 OR
		(SUBSTRING(@Time,1,2) > 24) OR 
		(SUBSTRING(@Time,4,2) > 60) OR
		(SUBSTRING(@Time,7,2) > 60))

UPDATE PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	SET ERRORDESC2 = CONCAT(ERRORDESC2,'TargetDaysFromProjectComplete is not an integer','; ')
	,ERRORSTATUS2 = CONCAT(ERRORSTATUS2, 'Constraint', '; ')
	FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK	
	WHERE 
		TargetDaysFromProjectComplete LIKE '%[^0-9]%'

UPDATE PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	SET ERRORDESC2 = CONCAT(ERRORDESC2,'LineNumber is not a real number','; ')
	,ERRORSTATUS2 = CONCAT(ERRORSTATUS2, 'Constraint', '; ')
	FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK	
	WHERE 
		LineNumber LIKE '%[^0-9.]%'

UPDATE PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	SET ERRORDESC = CONCAT(ERRORDESC,'Template is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	WHERE 
		Template= '' or Template is null

UPDATE PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	SET ERRORDESC = CONCAT(ERRORDESC,'CompanySelection is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	WHERE 
		CompanySelection= '' or CompanySelection is null

UPDATE PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	SET ERRORDESC = CONCAT(ERRORDESC,'Task is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	WHERE 
		Task= '' or Task is null

UPDATE PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	SET ERRORDESC = CONCAT(ERRORDESC,'TargetDaysFromProjectComplete is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	WHERE 
		TargetDaysFromProjectComplete= '' or TargetDaysFromProjectComplete is null

UPDATE PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	SET ERRORDESC = CONCAT(ERRORDESC,'DueTime is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	WHERE 
		DueTime= '' or DueTime is null

UPDATE PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	SET ERRORDESC = CONCAT(ERRORDESC,'LineNumber is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	WHERE 
		LineNumber= '' or LineNumber is null

UPDATE PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	SET ERRORDESC = CONCAT(ERRORDESC,'Area is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	WHERE 
		Area= '' or Area is null

UPDATE PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	SET ERRORDESC = CONCAT(ERRORDESC,'ClosingRole is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	WHERE 
		ClosingRole= '' or ClosingRole is null

UPDATE PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	SET ERRORDESC = CONCAT(ERRORDESC,'TaskLinkType is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	WHERE 
		TaskLinkType= '' or TaskLinkType is null

UPDATE PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	SET ERRORDESC = CONCAT(ERRORDESC,'Area is not there in NAME of Area','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK A
	WHERE 
		Area IS NOT NULL AND Area NOT IN 
		(SELECT B.NAME FROM PWC_E_AREA B WHERE B.ErrorDesc IS NULL AND B.ErrorDesc2 IS NULL AND (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.NAME IS NOT NULL)


UPDATE PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	SET ERRORDESC = CONCAT(ERRORDESC,'ClosingRole is not there in NAME of Closing Role','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Error', '; ')
	FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK A
	WHERE 
		ClosingRole IS NOT NULL AND ClosingRole NOT IN 
		(SELECT B.NAME FROM PWC_E_CLOSINGROLES B WHERE B.ErrorDesc IS NULL AND B.ErrorDesc2 IS NULL AND (B.DATAAREAID = A.DATAAREAID OR UPPER(B.DATAAREAID) = 'GLOBAL') AND B.NAME IS NOT NULL)

UPDATE PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	SET ERRORDESC = CONCAT(ERRORDESC,'Template,LineNumber,DATAAREAID has duplicate values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK
	WHERE 
		Template IS NOT NULL AND LineNumber IS NOT NULL AND CONCAT(Template,LineNumber,DATAAREAID) IN 
		(SELECT CONCAT(Template,LineNumber,DATAAREAID) FROM PWC_E_LEDGERPERIODCLOSETEMPLATETASK
		GROUP BY CONCAT(Template,LineNumber,DATAAREAID) HAVING COUNT(*)>1)





Area----

UPDATE PWC_E_AREA
	SET ERRORDESC = CONCAT(ERRORDESC,'NAME is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_AREA
	WHERE 
		NAME= '' or NAME is null

UPDATE PWC_E_AREA
	SET ERRORDESC = CONCAT(ERRORDESC,'DESCRIPTION is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_AREA
	WHERE 
		DESCRIPTION= '' or DESCRIPTION is null

UPDATE PWC_E_AREA
	SET ERRORDESC = CONCAT(ERRORDESC,'NAME,DATAAREAID has duplicate values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_AREA
	WHERE 
		NAME IS NOT NULL AND CONCAT(NAME,DATAAREAID) IN 
		(SELECT CONCAT(NAME,DATAAREAID) FROM PWC_E_AREA
		GROUP BY NAME,DATAAREAID HAVING COUNT(*)>1)





Closing Roles----

UPDATE PWC_E_CLOSINGROLES
	SET ERRORDESC = CONCAT(ERRORDESC,'NAME is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_CLOSINGROLES
	WHERE 
		NAME= '' or NAME is null

UPDATE PWC_E_CLOSINGROLES
	SET ERRORDESC = CONCAT(ERRORDESC,'DESCRIPTION is blank','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Warning', '; ')
	FROM PWC_E_CLOSINGROLES
	WHERE 
		DESCRIPTION= '' or DESCRIPTION is null

UPDATE PWC_E_CLOSINGROLES
	SET ERRORDESC = CONCAT(ERRORDESC,'NAME,DATAAREAID has duplicate values','; ')
	,ERRORSTATUS = CONCAT(ERRORSTATUS, 'Constraint', '; ')
	FROM PWC_E_CLOSINGROLES
	WHERE 
		NAME IS NOT NULL AND CONCAT(NAME,DATAAREAID) IN 
		(SELECT CONCAT(NAME,DATAAREAID) FROM PWC_E_CLOSINGROLES
		GROUP BY NAME,DATAAREAID HAVING COUNT(*)>1)
